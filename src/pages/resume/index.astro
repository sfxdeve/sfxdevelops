---
import SectionTitle from "../../components/blocks/section-title.astro";
import RootLayout from "../../components/layouts/root-layout.astro";
import Divider from "../../components/ui/divider.astro";
import {
  education,
  languages,
  positioningSummary,
  profile,
  skillGroups,
} from "../../data/portfolio";
---

<RootLayout
  title="Resume and Technical Skills"
  description="Technical profile and capability map for Shayan Fareed."
>
  <main data-page="resume" class="px-4 pb-8 sm:px-6 sm:pb-10">
    <SectionTitle
      kicker="Resume"
      title="Technical Resume and Capability Overview"
      description="A structured view of technical strengths, delivery style, and communication readiness for product teams."
    />

    <section class="mx-auto grid w-full max-w-6xl gap-4 lg:grid-cols-[1.15fr_0.85fr]">
      <article class="invisible opacity-0 surface rounded-xl p-6 sm:p-7" data-resume-card data-anim-card>
        <div class="accent-line max-w-24" data-anim-accent></div>
        <p class="eyebrow mt-4">Profile</p>
        <h2 class="mt-3 font-display text-4xl font-bold leading-tight text-paper-50">{profile.name}</h2>
        <p class="mt-2 text-sm text-paper-200">{profile.title}</p>
        <ul class="mt-5 list-disc space-y-2 pl-5 text-sm text-paper-100 marker:text-paper-300">
          {
            positioningSummary.map((point) => (
              <li class="invisible opacity-0" data-anim-list-item>{point}</li>
            ))
          }
        </ul>
      </article>

      <article class="invisible opacity-0 surface-muted rounded-xl p-6 sm:p-7" data-resume-card data-anim-card>
        <div class="accent-line max-w-24" data-anim-accent></div>
        <p class="eyebrow mt-4">Working Style</p>
        <p class="invisible opacity-0 mt-3 text-sm text-paper-100" data-anim-list-item>
          {profile.brand?.availability ?? "Available for remote product teams and collaboration-focused delivery."}
        </p>
        <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-paper-100 marker:text-paper-300">
          {
            (profile.brand?.focusAreas ?? []).map((area) => (
              <li class="invisible opacity-0" data-anim-list-item>{area}</li>
            ))
          }
        </ul>
      </article>
    </section>

    <section class="mx-auto mt-10 w-full max-w-6xl sm:mt-12">
      <Divider label="Skill Clusters" />
    </section>

    <section class="mx-auto mt-6 w-full max-w-6xl sm:mt-7">
      <ul class="grid gap-4 md:grid-cols-2 xl:grid-cols-3">
        {
          skillGroups.map((group) => (
            <li>
              <article class="invisible opacity-0 surface-muted h-full rounded-lg p-5" data-resume-card data-anim-card>
                <div class="accent-line max-w-24" data-anim-accent></div>
                <h3 class="mt-4 font-display text-2xl font-bold leading-tight text-paper-50">{group.name}</h3>
                <ul class="mt-4 flex flex-wrap gap-2">
                  {
                    group.items.map((skill) => (
                      <li
                        class="invisible opacity-0 rounded border border-paper-200/20 px-2.5 py-1 text-xs text-paper-100"
                        data-anim-list-item
                      >
                        {skill}
                      </li>
                    ))
                  }
                </ul>
              </article>
            </li>
          ))
        }
      </ul>
    </section>

    <section class="mx-auto mt-10 w-full max-w-6xl sm:mt-12">
      <Divider label="Languages & Education" />
    </section>

    <section class="mx-auto mt-6 grid w-full max-w-6xl gap-4 sm:mt-7 lg:grid-cols-2">
      <article class="invisible opacity-0 surface rounded-xl p-6 sm:p-7" data-resume-card data-anim-card>
        <div class="accent-line max-w-24" data-anim-accent></div>
        <p class="eyebrow mt-4">Languages</p>
        <ul class="mt-4 space-y-2">
          {
            languages.map((language) => (
              <li
                class="invisible opacity-0 flex items-center justify-between border-b border-paper-200/15 py-2"
                data-anim-list-item
              >
                <span class="text-sm text-paper-100">{language.name}</span>
                <span class="text-xs text-paper-200">{language.level}</span>
              </li>
            ))
          }
        </ul>
      </article>

      <article class="invisible opacity-0 surface rounded-xl p-6 sm:p-7" data-resume-card data-anim-card>
        <div class="accent-line max-w-24" data-anim-accent></div>
        <p class="eyebrow mt-4">Education</p>
        <ul class="mt-4 space-y-3">
          {
            education.map((item) => (
              <li class="invisible opacity-0 surface-muted rounded-md p-4" data-anim-list-item>
                <h4 class="text-base font-semibold text-paper-50">{item.degree}</h4>
                <p class="mt-1 text-sm text-paper-100">{item.institution}</p>
                <p class="mt-2 text-xs text-paper-300">{item.location} • {item.expected} • {item.gpa}</p>
              </li>
            ))
          }
        </ul>
      </article>
    </section>
  </main>
</RootLayout>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);
  const EASE = "power2.out";
  const CARD_FROM = { autoAlpha: 0, y: 24 };
  const CARD_TO = { autoAlpha: 1, y: 0, duration: 0.42, ease: EASE };
  const ITEM_FROM = { autoAlpha: 0, y: 12 };
  const ITEM_TO = { autoAlpha: 1, y: 0, duration: 0.26, ease: EASE };
  const ITEM_STAGGER = 0.05;
  const ACCENT_FROM = { scaleX: 0, transformOrigin: "left center" };
  const ACCENT_TO = { scaleX: 1, duration: 0.28, ease: EASE };

  const runResumeAnimations = () => {
    const root = document.querySelector('[data-page="resume"]');

    if (!root) {
      return;
    }

    ScrollTrigger.getAll().forEach((trigger) => {
      const id = trigger.vars.id;
      if (typeof id === "string" && id.startsWith("resume-")) {
        trigger.kill();
      }
    });

    if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
      gsap.set("[data-resume-card], [data-anim-accent], [data-anim-list-item]", {
        autoAlpha: 1,
      });
      return;
    }

    gsap.utils.toArray<HTMLElement>("[data-resume-card]").forEach((card, index) => {
      const accent = card.querySelector("[data-anim-accent]");
      const items = card.querySelectorAll("[data-anim-list-item]");

      gsap.fromTo(
        card,
        CARD_FROM,
        {
          ...CARD_TO,
          scrollTrigger: {
            id: `resume-card-${index}`,
            trigger: card,
            start: "top 86%",
            once: true,
          },
        },
      );

      if (accent) {
        gsap.fromTo(
          accent,
          ACCENT_FROM,
          {
            ...ACCENT_TO,
            scrollTrigger: {
              id: `resume-accent-${index}`,
              trigger: card,
              start: "top 86%",
              once: true,
            },
          },
        );
      }

      if (items.length) {
        gsap.fromTo(
          items,
          ITEM_FROM,
          {
            ...ITEM_TO,
            stagger: ITEM_STAGGER,
            scrollTrigger: {
              id: `resume-items-${index}`,
              trigger: card,
              start: "top 82%",
              once: true,
            },
          },
        );
      }
    });

    ScrollTrigger.refresh();
  };

  const beforeSwapResumeAnimations = () => {
    ScrollTrigger.getAll().forEach((trigger) => {
      const id = trigger.vars.id;
      if (typeof id === "string" && id.startsWith("resume-")) {
        trigger.kill();
      }
    });
  };

  if (document.documentElement.dataset.resumeListenerBound !== "1") {
    document.addEventListener("astro:page-load", runResumeAnimations);
    document.addEventListener("astro:before-swap", beforeSwapResumeAnimations);
    document.documentElement.dataset.resumeListenerBound = "1";
  }
</script>
