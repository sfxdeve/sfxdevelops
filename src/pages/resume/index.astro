---
import SectionTitle from "../../components/blocks/section-title.astro";
import RootLayout from "../../components/layouts/root-layout.astro";
import Divider from "../../components/ui/divider.astro";
import { languages } from "../../data/portfolio";
import { profile } from "../../data/portfolio";
import { positioningSummary } from "../../data/portfolio";
import { skillGroups } from "../../data/portfolio";
import { cn } from "../../lib/utils";
---

<RootLayout
	title="Resume"
	description="Technical skills, education, and professional positioning for Shayan Fareed."
>
	<main data-page="resume">
		<SectionTitle
			kicker="Resume"
			title="Technical Profile"
			description="Structured skills, education, and communication strengths for high ownership software roles."
		/>
		<section class="px-4">
			<div class="container mx-auto">
				<Divider label="Skills" />
			</div>
		</section>
		<section class="p-4 sm:py-12">
			<ul
				class="container mx-auto grid gap-4 md:grid-cols-2 xl:grid-cols-3"
			>
				<li>
					<article
						class="invisible opacity-0 space-y-6 h-full border-4 p-4 transition duration-300 ease-out bg-ink-900 hover:-translate-1 sm:p-6"
						data-resume-card
					>
						<div class={"h-2 w-16 bg-safety-500"}></div>
						<div class="space-y-4">
							<div>
								<h3
									class="font-display uppercase tracking-wider text-3xl text-paper-50"
								>
									Positioning
								</h3>
								<p
									class="font-mono uppercase tracking-widest text-xs text-paper-200"
								>
									{profile.name} | {profile.title}
								</p>
							</div>
							<ul
								class="space-y-2 pl-4 text-sm list-disc marker:text-safety-500"
							>
								{
									positioningSummary.map((point) => (
										<li>{point}</li>
									))
								}
							</ul>
						</div>
					</article>
				</li>
				{
					skillGroups.map((category, index) => (
						<li>
							<article
								class="invisible opacity-0 space-y-6 h-full border-4 p-4 transition duration-300 ease-out bg-ink-900 hover:-translate-1 sm:p-6"
								data-resume-card
							>
								<div
									class={cn(
										"h-2 w-16 bg-safety-500",
										index % 2 === 0 && "bg-acid-300",
									)}
								/>
								<div class="space-y-4">
									<div>
										<h3 class="font-display uppercase tracking-wider text-3xl text-paper-50">
											{category.name}
										</h3>
									</div>
									<ul class="flex flex-wrap gap-2">
										{category.items.map((skill) => (
											<li
												class="invisible opacity-0 border-2 border-paper-300 py-1 px-3 font-mono uppercase tracking-widest text-xs text-paper-100"
												data-resume-skill-chip
											>
												{skill}
											</li>
										))}
									</ul>
								</div>
							</article>
						</li>
					))
				}
				<li>
					<article
						class="invisible opacity-0 space-y-6 h-full border-4 p-4 transition duration-300 ease-out bg-ink-900 hover:-translate-1 sm:p-6"
						data-resume-card
					>
						<div
							class={cn(
								"h-2 w-16 bg-safety-500",
								skillGroups.length % 2 === 0 && "bg-acid-300",
							)}
						>
						</div>
						<div class="space-y-4">
							<div>
								<h3
									class="font-display uppercase tracking-wider text-3xl text-paper-50"
								>
									Languages
								</h3>
							</div>
							<ul class="space-y-2">
								{
									languages.map((language) => (
										<li
											class="invisible opacity-0 border-b border-paper-300 flex items-start justify-between"
											data-resume-language
										>
											<span>{language.name}</span>
											<span class="font-mono uppercase tracking-widest text-xs text-acid-100">
												{language.level}
											</span>
										</li>
									))
								}
							</ul>
						</div>
					</article>
				</li>
			</ul>
		</section>
	</main>
</RootLayout>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";

	gsap.registerPlugin(ScrollTrigger);

	const resetResumeTriggers = () => {
		ScrollTrigger.getAll().forEach((trigger) => {
			const id = trigger.vars.id;

			if (typeof id === "string" && id.startsWith("sfx-resume-")) {
				trigger.kill();
			}
		});
	};

	const runResumeAnimations = () => {
		const root = document.querySelector('[data-page="resume"]');

		if (!root) {
			return;
		}

		resetResumeTriggers();

		gsap.utils
			.toArray<HTMLElement>("[data-resume-card]")
			.forEach((card, index) => {
				gsap.fromTo(
					card,
					{ autoAlpha: 0, y: 16 },
					{
						autoAlpha: 1,
						y: 0,
						duration: 0.3,
						ease: "power1.out",
						scrollTrigger: {
							id: `sfx-resume-card-${index}`,
							trigger: card,
							start: "top 85%",
							once: true,
						},
					},
				);
			});

		gsap.utils
			.toArray<HTMLElement>("[data-resume-skill-chip]")
			.forEach((chip, index) => {
				gsap.fromTo(
					chip,
					{ autoAlpha: 0, y: 8 },
					{
						autoAlpha: 1,
						y: 0,
						duration: 0.2,
						ease: "power1.out",
						scrollTrigger: {
							id: `sfx-resume-chip-${index}`,
							trigger: chip,
							start: "top 88%",
							once: true,
						},
					},
				);
			});

		gsap.utils
			.toArray<HTMLElement>("[data-resume-language]")
			.forEach((language, index) => {
				gsap.fromTo(
					language,
					{ autoAlpha: 0, x: -8 },
					{
						autoAlpha: 1,
						x: 0,
						duration: 0.2,
						ease: "power1.out",
						scrollTrigger: {
							id: `sfx-resume-language-${index}`,
							trigger: language,
							start: "top 88%",
							once: true,
						},
					},
				);
			});

		ScrollTrigger.refresh();
	};

	if (document.documentElement.dataset.sfxResumeListenerBound !== "1") {
		document.addEventListener("astro:page-load", runResumeAnimations);
		document.addEventListener("astro:before-swap", resetResumeTriggers);
		document.documentElement.dataset.sfxResumeListenerBound = "1";
	}
</script>
